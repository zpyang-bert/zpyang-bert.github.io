---
layout:     post
title:      "SerDes基础"
date:       2024-06-14 11:41:05
author:     "Bert"
header-style: text
tags:
  - SerDes
---



## Overview

梳理一些`SerDes`相关通用知识.

[`SerDes`](https://en.wikipedia.org/wiki/SerDes)(串行器/解串器), 用于**串行数据**和**并行数据**之间的转换数据**接口**. 

**为什么要有`SerDes`这个技术的存在?**

回答这个问题之前需要先理解`串行传输`和`并行传输`的优缺点.

**串行传输 vs. 并行传输**

| 传输方式 | 优点                                                         | 缺点                                                         |
| :------- | :----------------------------------------------------------- | ------------------------------------------------------------ |
| 串行传输 | 1. **更高的传输效率**: 串行传输通过高速时钟将数据按位序列化传输，因此可以实现更高的传输速率.<br />2. **节省IO资源**: 串行传输只需要少量的信号线，可以减少系统所需的物理连接资源，从而降低成本和复杂度.<br />3. **较低的功耗:** 由于信号线较少，串行传输通常消耗较少的功率.<br />4. **适合远距离传输**: 串行传输可以更容易地实现远距离传输，适用于需要长距离通信的应用场景. | 1. **低效率**: 相对于并行传输，在传输一定量的数据时，串行传输需要较长的时间，效率较低.<br />2. **时钟同步要求高**：串行传输对时钟同步要求较高，时钟信号的提取和恢复可能对系统设计造成一定挑战. |
| 并行传输 | 1. **高效率**：并行传输可以同时传输多个数据位，因此在传输大量数据时速度较快，效率高. <br />2. **时延低**：由于并行传输同时传输多个信号，其传输速度相对快，可以降低数据传输的延迟. <br />3. **时序控制简单**：并行传输相对串行传输更容易实现时序控制和同步. | 1. **资源需求高**：并行传输需要多条并行信号线，占用较多资源，布线复杂度高. <br />2. **容易受干扰**：在高速传输时，由于并行线之间存在相互干扰和串扰，容易导致信号完整性和稳定性问题. <br />3. **短距离传输**：并行传输通常适用于短距离传输，超长距离传输需要更复杂的调节和管理. |

**市场需求和标准化**

许多现代通信和计算设备, 如高速网络通信(以太网, 光纤通信), 存储系统, 高性能计算系统等, 都需要在性能, 成本和可靠性之间找到平衡.

**需求如下:**

+ 高速长距离传输, 高速长距离传输面临信号完整性挑战, 如时钟抖动, 串扰等问题.
+ 节省IO和降低功耗的需求.
+ 在系统应用中, 需要同时传输多个数据位, 高带宽的需求. 

综上所述，虽然串行传输在某些情况下已经足够，但在面对大规模数据传输、高速传输要求和复杂的系统环境时，通过`SerDes`将串行数据转换为并行数据可以更好地满足技术和市场需求。这种转换不仅提高了传输效率和带宽利用率，还解决了信号完整性和系统复杂性的挑战，因此在现代通信和计算设备中得到了广泛的应用。

### SerDes通用功能

#### PISO(并行输入-串行输出)

- **输入**：接收并行数据以及并行时钟信号。
- **操作**：将并行数据转换为串行数据。通常使用**移位寄存器**，在每个时钟周期接收并行数据，并以更高速率串行输出。
- **时钟管理**：使用相位锁定环（`PLL`）来同步并将输入的并行时钟频率**提升**到更高的串行时钟频率。这确保了从并行到串行数据的准确转换，避免由于时序不匹配而导致的数据丢失或损坏。

#### SIPO(串行输入-并行输出)

- **输入**：接收串行数据以及从**数据中恢复**的时钟信号（如果执行了时钟恢复）。
- **操作**：将串行数据转换为并行数据。串行数据接收并使用恢复的时钟信号进行同步。然后，以适合目标设备的低速率并行输出数据。
- **时钟恢复**：使用技术从接收到的串行数据中恢复时钟信号。如果 `SerDes` 不传输时钟，则使用参考时钟将 `PLL` 锁定到正确的发送频率，确保同步和正确的数据接收。

### `SerDes`的架构类型

| 架构类型        | 说明                                                         |
| --------------- | ------------------------------------------------------------ |
| Parallel clock  | 使用单独的时钟信号与数据一起传输。两端根据此信号同步它们的时钟。 |
| Embedded clock  | 在数据本身中嵌入时间信息，而不发送单独的时钟信号。接收端通过数据流中提取的时钟信息执行时钟恢复。 |
| 8b/10b encoding | 使用编码，其中每 8 位数据转换为 10 位编码。这确保了在时间上有平衡的 0 和 1，有助于时钟恢复并减少电磁干扰(**直流平衡**)。 |
| Bit-interleaved | 同时处理多个数据流，将每个流的位交织成一个组合数据流进行传输。 |

**`SerDes`中的编码/解码目的:**

- **信号过渡的统计界限**：确保数据流中有足够的过渡，以维持时钟同步和恢复。
- **时钟恢复**：从接收到的数据流中轻松提取时钟信息，实现精确的数据接收。
- **帧同步**：在数据流中提供标记或模式，以标识单个帧或数据包的起始和结束位置。
- **直流平衡**：保持平衡的 0 和 1 的数量，防止信号退化，并确保可靠的传输。

### 常用学术概念

#### Bandgap Reference

`Bandgap Reference`（带隙参考电源）是一种非常重要的电子组件，用于提供准确且稳定的参考电压，这种电压几乎不受温度变化、供电电压波动或其他环境因素的影响。下面，我将详细解释 `Bandgap Reference` 的原理和应用。

1. **理论基础**

`Bandgap Reference` 的设计基于半导体物理中的基本概念——带隙。带隙是指半导体中禁带的能量，即价带最高能级与导带最低能级之间的能量差。对于硅，这个能量大约是 1.1 电子伏特（eV）。

2. **温度补偿原理**

`Bandgap Reference` 设计的关键是利用不同电子元件（如二极管和晶体管）的温度特性来抵消温度变化的影响。这通常通过以下两个温度依赖性相反的电压进行组合实现：

- **PTAT（Proportional To Absolute Temperature）电压**：这种电压随温度线性增加，其表达式通常为 ( V_{PTAT} = V_T \ln(N) )，其中 ( V_T ) 是热电压，( N ) 是某个常数，( V_T = kT/q )，其中 ( k ) 是玻尔兹曼常数，( T ) 是绝对温度，( q ) 是电子电荷。
- **CTAT（Complementary To Absolute Temperature）电压**：这种电压随温度线性减小，通常通过一个或多个正向偏置的二极管或晶体管基-发射结来实现。

3. **结合 PTAT 和 CTAT**

`Bandgap Reference` 的核心设计是将 PTAT 和 CTAT 电压相加，以便它们的温度系数相互抵消。理想的组合结果是一个既不随温度增加也不随温度减少的稳定电压。这个最终的参考电压被设计为接近硅的带隙电压，约为 1.22V，这也是为什么它被称为“带隙参考”的原因。

4. **实际电路设计**

实际上，`Bandgap Reference` 电路包含一个运算放大器，用于调节输出并保持电压稳定。通过精确调整 PTAT 和 CTAT 电压源中的元件（如电阻、二极管和晶体管的数量和类型），可以获得所需的输出电压。

5. **应用**

`Bandgap Reference` 广泛用于各种电子系统中，尤其是在那些需要高精度和高稳定性的应用中，例如：

- 模拟信号处理
- 数据转换器（`ADC` 和 `DAC`）
- 电源管理电路
- 微处理器和微控制器中的电压监控

6. **优势与局限**

+ **优势**：
  + 提供准确且稳定的参考电压
  + 对环境变化具有很高的抗干扰能力

+ **局限**：
  + 需要仔细的电路设计和调校
  + 在极端的环境条件下，其性能可能受到影响

`Bandgap Reference` 的设计优化通常是集成电路设计中一个复杂但关键的部分，需要专业知识来确保最佳性能。

#### LC synthesizer 

在`SERDES`设计中，`LC synthesizer` 是一种关键的组件，用于生成高精度、高稳定性的时钟信号或数据传输频率。这种合成器主要依赖于 LC 振荡器，其中 "L" 代表电感，"C" 代表电容。`LC synthesizer` 在数据通信和高速数据传输技术中非常重要，因为它们提供用于编码和解码数据的精确时钟信号。

**基本工作原理**

`LC synthesizer` 的核心是 `LC` 振荡器，它利用电感（L）和电容（C）形成的谐振电路产生稳定的振荡频率。这种频率的稳定性和准确性对于保证数据在发送和接收端正确同步非常关键。

**LC 振荡器的特点**

1. **高Q因子**：LC 振荡器通常具有高Q值（品质因数），意味着振荡器具有较低的能量损耗和高频率稳定性。
2. **低相位噪声**：由于较高的Q因子，LC 振荡器在频率合成器中应用时，能够提供低相位噪声的输出，这是高速串行数据传输中非常重要的性质。

**`LC Synthesizer` 在 `SERDES` 中的应用**

在 `SERDES` 设计中，`LC synthesizer` 主要用于以下几个方面：

- **时钟生成**：为序列化器和解序列器提供精确的时钟信号，确保数据流的稳定性和同步。
- **数据恢复**：在接收端，`LC synthesizer` 可用于重新生成传输过程中可能受到干扰的时钟信号，以便正确解码接收到的数据。

**设计挑战**

尽管 `LC synthesizer` 在理论上具有许多优点，但在实际设计和实现中也面临一些挑战：

- **温度和电源变化的敏感性**：虽然`LC`振荡器的性能较稳定，但仍受到环境因素如温度波动和电源稳定性的影响。
- **物理尺寸和成本**：电感通常需要较大的物理空间，这可能会增加整体系统的尺寸和成本。

**`LC Synthesizer`的输入和输出**

+ **输入**: 接受**外部低频参考时钟**（如晶体振荡器), 并可能对这个信号进行再缓冲（`rebuffering`）处理，以适应后续电路的需求。
+ **输出**: 缓冲和再放大, 为高速数据传输提供必要的**高频**时钟频率。

**结论**

`LC synthesizer` 通过提供高质量的时钟信号，支撑了 `SERDES` 设计的核心功能，使其在高速数据通信领域发挥关键作用。尽管存在一些设计上的挑战，但其优点使得在许多高性能通信系统中，它仍是首选的时钟源解决方案。

#### VCO

`SERDES`中的`VCO`（Voltage-Controlled Oscillator）是一种关键的电子组件，用于生成可变频率的时钟或信号，其频率通过电压水平控制。在`SERDES`设计中，`VCO`通常是`PLL`（Phase-Locked Loop）系统的一部分，它**扮演着生成精确时钟频率**的重要角色，这对于数据的高速串行传输至关重要。

**功能和重要性**

在`SERDES`系统中，`VCO`的主要功能包括：

- **时钟生成**：`VCO`产生的时钟频率用于驱动序列化和反序列化过程，确保数据可以在发送和接收端正确地同步和处理。
- **频率调整**：通过调整控制电压，`VCO`可以改变输出频率，这允许系统根据接口速率或其他外部条件动态调整时钟频率。

**如何工作**

`VCO`在`SERDES`的`PLL`电路中通常与其他几个关键组件一起工作：

1. **相位比较器**（Phase Comparator）：比较参考时钟（来自外部源或系统内部其他时钟）与`VCO`输出的相位差。
2. **环路滤波器**（Loop Filter）：调整**相位比较器**的输出，以适当控制`VCO`的输入电压，**从而细调其频率**。
3. **`VCO`**：根据来自环路滤波器的电压调整其输出频率。
4. **分频器**（Divider）：根据需要将`VCO`的高频输出降频，以便与参考时钟进行比较。

通过这种配置，`PLL`能够锁定到一个给定的参考频率，确保`VCO`输出与系统需求相匹配，从而支持高效且错误率低的数据传输。

**应用**

`VCO`的应用不仅限于`SERDES`，它也广泛用于无线通信、广播和许多其他需要精确控制频率的场景。在`SERDES`中，准确的`VCO`是高性能数据传输的核心，特别是在高速、高带宽的数据中心、计算机网络和通信系统中。通过`VCO`，`SERDES`能够适应不同的数据速率和传输条件，从而在现代电子和通信系统中发挥着至关重要的作用。

#### DLPF

在`SerDes`技术中，`DLPF`通常指的是“数字低通滤波器”（**Digital Low Pass Filter**）。这种滤波器在高速数据通信中起到至关重要的作用，特别是在处理信号时用于**减少高频噪声和提高信号完整性**。

**功能和重要性**

数字低通滤波器在`SerDes`系统中的主要功能包括：

- **噪声抑制**：在数字通信系统中，由于电子设备的电气噪声、信号反射和串扰等原因，信号会损失纯净度。`DLPF`有助于消除这些高频噪声分量，减少误码率。
- **信号整形**：`DLPF`也可以用来整形信号波形，改善其特性以适应特定的传输要求或接收器的灵敏度。

**如何工作**

数字低通滤波器通过允许频率低于特定截止频率的信号分量通过，而阻止高于这个频率的分量通过，来实现其滤波效果。在实际的`SerDes`系统中，`DLPF`可以是基于软件的实现，也可以是集成在硬件中的固定功能。

**设计与实现**

数字低通滤波器可以通过多种方法实现，其中包括：

1. **FIR滤波器**（Finite Impulse Response Filter）：这种滤波器通过一系列的**加权数字样本**来实现，其**输出是输入信号样本与固定权重系数的卷积**。FIR滤波器是**线性相位滤波器**，不会引起信号相位的扭曲。
2. **IIR滤波器**（Infinite Impulse Response Filter）：与FIR滤波器不同，IIR滤波器的输出**不仅依赖于当前和过去的输入，还依赖于过去的输出**。IIR滤波器通常效率更高，**但可能引起相位非线性**。

**应用**

在`SerDes`系统中，数字低通滤波器经常与其他数字信号处理元件（如均衡器）一起工作，以优化在高速传输线路上接收到的信号。通过有效地降低噪声和改善信号特性，`DLPF`对于保证数据在高速链路上可靠传输非常关键。

**综上所述**，`DLPF`在`SerDes`技术中是一种关键的数字信号处理工具，用于保持信号质量并确保数据传输的高效性和可靠性。

### IQ

在通信系统中，`IQ`（In-phase and Quadrature）信号是一种重要的表示方法，用于有效地传输和处理模拟和数字信号。IQ表示法利用正交调制技术，即将信号分为两个分量：同相（I）和正交（Q）分量，这两个分量相互正交（**相差90度相位**）。

同相（I）和正交（Q）分量

1. **同相分量 (I)**：这是与原始信号的相位对齐的分量，代表信号的余弦部分。
2. **正交分量 (Q)**：这是与原始信号相位相差90度的分量，代表信号的正弦部分。

将复杂的信号分解为这两个分量允许信号在不同的通道中独立传输和处理，提高了信号处理的灵活性和效率。这种技术广泛应用于无线通信、雷达系统、调制技术和其他需要信号处理的领域。

**IQ信号的作用**

1. **增加带宽效率**：通过同时在两个正交通道传输信息，IQ调制能够在**相同的频带宽度下传输更多的数据**，**从而提高频谱效率**。
2. **支持多种调制方案**：`IQ`信号可以用来实现多种**调制**技术，如`QPSK`（Quadrature Phase Shift Keying）、`QAM`（Quadrature Amplitude Modulation）等。这些调制技术能有效地传输更高的数据率。
3. **误差和失真的处理**：在信号传输过程中，`IQ`不平衡（如增益不匹配或相位偏移）会导致性能降低。通过对IQ信号进行精确的控制和调整，可以优化系统性能，减少这些失真。

**IQ不平衡和调整**

在实际应用中，理想的正交关系很难保持，常常出现`IQ`不平衡，包括增益不匹配和相位偏移，这会导致信号的干扰和性能降低。系统需要对这些不平衡进行补偿：

1. **增益不匹配**：如果I和Q通道的增益不相等，会导致接收到的信号失真。
2. **相位偏移**：如果I和Q分量之间的90度相位关系未被精确保持，将影响信号的完整性。

通过使用各种数字信号处理技术，如自适应滤波器和算法，系统可以动态调整并补偿这些不平衡，确保信号质量和系统性能。

总的来说，`IQ`信号在现代通信技术中扮演着核心角色，它通过将信号分解为两个正交分量，不仅提高了信号的处理效率和频谱使用效率，还允许更加复杂的调制和误差处理技术的实施。

### DCD

`DCD`（Duty Cycle Distortion），即`占空比失真`，是一种在数字信号传输中常见的信号失真现象，特别是在高速通信中。占空比是指在一个周期内，信号处于高电平状态的时间与整个周期的时间的比率。理想情况下，数字信号（如方波）的占空比应该是固定的，例如在标准的数字信号中常见的50%，意味着信号的高电平和低电平时间相等。然而，由于各种原因，实际传输中的信号占空比可能会偏离预期，这就产生了占空比失真。

**`DCD`的原因**

1. **传输介质的不均匀性**：如电缆的不同部分电气特性不一致（如阻抗、电容），可能导致信号传输速度的差异，进而影响信号的占空比。
2. **信号反射和串扰**：在信号沿传输线路传播时，可能会遇到**阻抗不匹配**的点，导致信号反射，或者由于线路之间的**电磁干扰产生串扰**，这些都可能影响信号的占空比。
3. **驱动器和接收器的不匹配**：发送和接收端电子设备的电气特性如果不匹配，也可能引起占空比的偏差。
4. **高速信号的频率响应不足**：在高速数字通信中，如果信号源或传输介质的**频率响应不足以支持所需的信号频率**，也会导致信号形状变形，影响占空比。

**`DCD`的影响**

1. **数据传输错误**：`占空比失真`可以导致接收端硬件错误地解读信号状态，可能会导致数据位错误，增加误码率。
2. **系统性能降低**：在一些高性能计算或通信系统中，`占空比失真`可能导致系统无法达到最高效的数据传输速率，影响整体性能。
3. **同步问题**：在需要严格时钟同步的系统中，如某些数字接口或时序敏感的应用，**占空比失真可能导致时钟恢复困难**，影响系统稳定性和性能。

**解决`DCD`的方法**

1. **使用高质量的传输介质**：选择高质量、低衰减、匹配良好的电缆和连接器可以减少信号失真。
2. **信号完整性分析和优化**：通过使用信号完整性分析工具检测潜在的信号失真问题，并进行适当的电路或系统设计优化。
3. **使用重复器和等化器**：在传输线路中适当位置使用信号重复器或等化器，可以帮助恢复信号的正确形状和占空比。
4. **改善电子设备的匹配**：确保发送端和接收端的电子设备在电气特性上能够良好匹配，以减少信号失真。

总之，`DCD`是一个在高速数字通信领域需要重点关注的问题，通过理解其成因和采取有效的解决措施，可以显著提高数据传输的可靠性和效率。

### `UI`

在高速数字通信领域，`UI`是“Unit Interval”的缩写，中文通常翻译为“单位间隔”。`UI`是衡量时间上的一个基本单位，用于描述**一位数据在信号传输中占用的时间长度**。这是一个特别重要的概念，因为它直接关系到数据传输速率和信号的完整性。

**`UI`的定义和重要性**

`UI`的长度是与数据传输速率（波特率）密切相关的。例如，如果一个通信系统的数据传输速率是`1 Gbps`（每秒传输10亿比特），那么**每个比特的时间间隔**（即一个`UI`的长度）是1纳秒。换句话说，`UI`是表示在一个数据比特被发送的持续时间内，信号的状态（高或低）保持不变的时间长度。

`UI`的概念对于设计和评估高速数字通信系统至关重要，因为：

1. **时钟和数据同步**：在接收端正确地恢复发送端的时钟信号和同步数据，依赖于准确地测量和处理每个`UI`。任何对`UI`长度的误解或变化都可能导致数据错误。
2. **信号完整性分析**：信号的任何失真，如**抖动**（信号的时间偏移）和**噪声**，都需要在`UI`的框架内进行测量和控制。如果失真过大，可能会导致`UI`重叠，从而导致数据错误。
3. **设计容错率**：在设计通信硬件和协议时，了解和控制`UI`是保证系统能在各种条件下可靠工作的基础。

**测量和应用**

在实际应用中，通常需要测量信号的`UI`以确保它符合设计规格。这通常通过使用示波器和相关的测量工具完成，这些工具能够精确地捕捉和分析在高速传输过程中信号的每个`UI`。

总结来说，`UI`是高速数字通信中一个核心概念，对于确保数据传输的速度和质量至关重要。理解和控制`UI`可以帮助工程师设计出更为可靠和高效的通信系统。

### pre-cursor/cursor/post-cursor

在高速数字通信中，尤其是在讨论信号的传输特性和均衡技术时，经常会遇到“pre-cursor”（前驱符号），“cursor”（游标符号），和“post-cursor”（后继符号）这几个术语。这些术语通常用于描述信号在传输线上由于串扰、反射、色散等非理想条件下的行为，尤其在使用高速串行技术如`PCIe`、`SATA`、`USB`等通信标准时非常重要。

定义

- **Cursor**：指的是当前正在传输的数据脉冲或信号。在信号均衡的上下文中，cursor通常指的是传输脉冲的主峰，也就是当前比特或符号的直接表示。在特定时间点，理想情况下应该接收到的信号值，即当前符号本身的影响。
- **Pre-cursor**：指的是在当前cursor之前的符号对当前符号造成的影响。这些是由于信号在传输过程中的前向散射或反射等因素造成的。
- **Post-cursor**：是指在当前信号点之后的一个或多个信号对当前信号点的干扰。这通常是由信号的后向延伸或色散造成的。

1. **信号的传输和影响因素**

在数字通信中，信息是以电信号的形式通过传输线（如同轴电缆、双绞线或印刷电路板的走线）发送的。理想情况下，发送端发送的电信号应该在接收端被完整无误地接收。然而，由于以下几种原因，信号在传输过程中会受到影响：

- **衰减**：信号在传输线上随**距离增加而逐渐减弱**。
- **色散**：信号中**不同频率**的成分传播速度不同，导致**信号波形扭曲**。
- **反射**：**接口不匹配**导致的信号反射。
- **串扰**：来自**相邻传输线**的信号干扰。

2. **`ISI`（Intersymbol Interference）介绍**

这些因素共同作用会造成“**符号间干扰**”（`ISI`），即**一个符号的信号会干扰到相邻符号的信号**。在高速传输中，由于符号之间的间隔非常短，`ISI`问题尤为严重。

3. **传输线上的信号示例**

假设我们要传输一个简单的二进制信号序列“101”，在没有任何均衡措施的情况下，由于`ISI`，接收端可能接收到的信号波形将会是这些信号的叠加，导致在决策时间点上信号的值不再是明确的0或1。

4. **均衡技术**

为了对抗`ISI`，可以采用以下两种主要的均衡技术：

- **发送端预加重（Pre-emphasis）**：通过在发送端增加信号的**高频成分**（主要针对post-cursors），来补偿高频信号在传输线上的损耗。
- **接收端均衡（Equalization）**：在接收端调整信号，尝试消除或减少信号传输过程中产生的畸变，包括`pre-cursors`和`post-cursors`的影响。接收端均衡器会分析接收到的信号，**调整其放大程度和相位**，以使得信号尽可能**还原**到发送端的原始状态。

通过这些技术的应用，可以显著提升信号的质量和通信的可靠性，特别是在高速数据传输的场景中。这就是为什么在现代通信系统设计中，理解和实施这些均衡技术是至关重要的。
